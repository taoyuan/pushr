(function e(t,n,i){function s(o,a){if(!n[o]){if(!t[o]){var c="function"==typeof require&&require;if(!a&&c)return c(o,!0);if(r)return r(o,!0);throw Error("Cannot find module '"+o+"'")}var u=n[o]={exports:{}};t[o][0].call(u.exports,function(e){var n=t[o][1][e];return s(n?n:e)},u,u.exports,e,t,n,i)}return n[o].exports}for(var r="function"==typeof require&&require,o=0;i.length>o;o++)s(i[o]);return s})({1:[function(e){(function(){this.Pushr=e("./lib/pushr")(e("faye/browser/faye-browser"))}).call(this)},{"./lib/pushr":4,"faye/browser/faye-browser":7}],2:[function(e,t,n){function i(e,t){r.call(this),this.name=e,this.pushr=t,this.client=t.client,this.subscription=null}var s=e("../utils"),r=e("eventemitter2").EventEmitter2;t.exports=n=i;var o=i.prototype;s.extend(o,r.prototype),o.bind=o.on,o.publish=function(e,t){return this.pushr._publish(this.name,e,t)},o.subscribe=function(e){function t(t){e&&e(t,n)}if(!this.subscription){var n=this;this.subscription=this.pushr._subscribe(this.name,s.createCallback(this.handleEvent,this,2)),this.subscription.callback(t),this.subscription.errback(t)}},o.unsubscribe=function(){this.subscription&&this.subscription.cancel(),this.subscription=null},o.handleEvent=function(e,t){this.emit(e,t)}},{"../utils":5,eventemitter2:6}],3:[function(e,t,n){"use strict";function i(){this.channels={}}function s(e,t){return new o(e,t)}var r=e("../utils"),o=e("./channel");t.exports=n=i;var a=i.prototype;a.add=function(e,t){return this.channels[e]||(this.channels[e]=s(e,t)),this.channels[e]},a.find=function(e){return this.channels[e]},a.remove=function(e){var t=this.channels[e];return delete this.channels[e],t},a.disconnect=function(){r.forEach(this.channels,function(e){e.disconnect()})}},{"../utils":5,"./channel":2}],4:[function(e,t,n){var i=e("./channels/channels"),s=e("./utils");t.exports=n=function(e){function t(){var t=n(arguments);t.url?this.client=new e.Client(t.url,t):t.client?this.client=t.client:(this.server=new e.NodeAdapter(t.mount?t:{mount:"/",timeout:45}),this.client=this.server.getClient()),this.channels=new i,this.client.bind("transport:down",function(){}),this.client.bind("transport:up",function(){})}function n(e){for(var t={},n=0;e.length>n;n++){var i=e[n];"string"==typeof i?i.indexOf("/")>=0?t.url=i:t.key=i:"object"==typeof i&&(i.subscribe&&i.publish?t.client=i:s.forEach(i,function(e,n){t[n]="timeout"===n?parseInt(e,120):"retry"===n?parseInt(e,5):e}))}return t}var r=t.prototype;return r.disconnect=function(){return this.client.disconnect()},r.channel=function(e){return this.channels.find(e)},r.subscribe=function(e,t){var n=this.channels.add(e,this);return n.subscribe(t),n},r.unsubscribe=function(e){var t=this.channels.remove(e);t.unsubscribe()},r.publish=function(e,t,n){return this._publish(e,t,n)},r._publish=function(e,t,n){var i=Array.isArray(e)?e:[e],r=s.toMessage(t,n),o=this,a=[];return s.forEach(i,function(e){a.push(o.client.publish(s.sureSlash(e),r))}),0===a.length?null:1===a.length?a[0]:a},r._subscribe=function(e,t){return this.client.subscribe(s.sureSlash(e),function(e){t=s.createCallback(t),e.__event__||e.__data__?t(e.__event__,e.__data__):t("data",e)})},t}},{"./channels/channels":3,"./utils":5}],5:[function(e,t,n){function i(e){return e}var s={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},r={keys:function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t},createCallback:function(e,t,n){if(null==e)return i;var s=typeof e;return"function"!=s?"object"!=s?function(t){return t[e]}:i:t===void 0?e:1===n?function(n){return e.call(t,n)}:2===n?function(n,i){return e.call(t,n,i)}:4===n?function(n,i,s,r){return e.call(t,n,i,s,r)}:function(n,i,s){return e.call(t,n,i,s)}},extend:function(e){for(var t=1;arguments.length>t;t++){var n=arguments[t];r.forEach(n,function(t,n){e[n]=t&&t.constructor&&t.constructor===Object?r.extend(e[n]||{},t):t})}return e},forOwn:function(e,t,n){var i,o=e,a=o;if(!o)return a;if(!s[typeof o])return a;t=t&&n===void 0?t:r.createCallback(t,n);for(var c=-1,u=s[typeof o]&&r.keys(o),h=u?u.length:0;h>++c;)if(i=u[c],t(o[i],i,e)===!1)return a;return a},forEach:function(e,t,n){var i=-1,s=e?e.length:0;if(t=t&&n===void 0?t:r.createCallback(t,n),"number"==typeof s)for(;s>++i&&t(e[i],i,e)!==!1;);else r.forOwn(e,t);return e},sureSlash:function(e,t){e||(e="");var n="/"===e.charAt(t?e.length-1:0)?"":"/";return t?e+n:n+e},toMessage:function(e,t){return{__event__:e,__data__:t}}};t.exports=n=r},{}],6:[function(e,t,n){var i=e("__browserify_process");!function(e){function t(){this._events={},this._conf&&n.call(this,this._conf)}function n(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners&&(this._events.maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),this.wildcard&&(this.listenerTree={}))}function i(e){this._events={},this.newListener=!1,n.call(this,e)}function s(e,t,n,i){if(!n)return[];var r,o,a,c,u,h,l,f=[],p=t.length,d=t[i],_=t[i+1];if(i===p&&n._listeners){if("function"==typeof n._listeners)return e&&e.push(n._listeners),[n];for(r=0,o=n._listeners.length;o>r;r++)e&&e.push(n._listeners[r]);return[n]}if("*"===d||"**"===d||n[d]){if("*"===d){for(a in n)"_listeners"!==a&&n.hasOwnProperty(a)&&(f=f.concat(s(e,t,n[a],i+1)));return f}if("**"===d){l=i+1===p||i+2===p&&"*"===_,l&&n._listeners&&(f=f.concat(s(e,t,n,p)));for(a in n)"_listeners"!==a&&n.hasOwnProperty(a)&&("*"===a||"**"===a?(n[a]._listeners&&!l&&(f=f.concat(s(e,t,n[a],p))),f=f.concat(s(e,t,n[a],i))):f=a===_?f.concat(s(e,t,n[a],i+2)):f.concat(s(e,t,n[a],i)));return f}f=f.concat(s(e,t,n[d],i+1))}if(c=n["*"],c&&s(e,t,c,i+1),u=n["**"])if(p>i){u._listeners&&s(e,t,u,p);for(a in u)"_listeners"!==a&&u.hasOwnProperty(a)&&(a===_?s(e,t,u[a],i+2):a===d?s(e,t,u[a],i+1):(h={},h[a]=u[a],s(e,t,{"**":h},i+1)))}else u._listeners?s(e,t,u,p):u["*"]&&u["*"]._listeners&&s(e,t,u["*"],p);return f}function r(e,t){e="string"==typeof e?e.split(this.delimiter):e.slice();for(var n=0,i=e.length;i>n+1;n++)if("**"===e[n]&&"**"===e[n+1])return;for(var s=this.listenerTree,r=e.shift();r;){if(s[r]||(s[r]={}),s=s[r],0===e.length){if(s._listeners){if("function"==typeof s._listeners)s._listeners=[s._listeners,t];else if(o(s._listeners)&&(s._listeners.push(t),!s._listeners.warned)){var c=a;this._events.maxListeners!==undefined&&(c=this._events.maxListeners),c>0&&s._listeners.length>c&&(s._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",s._listeners.length),console.trace())}}else s._listeners=t;return!0}r=e.shift()}return!0}var o=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=10;i.prototype.delimiter=".",i.prototype.setMaxListeners=function(e){this._events||t.call(this),this._events.maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e},i.prototype.event="",i.prototype.once=function(e,t){return this.many(e,1,t),this},i.prototype.many=function(e,t,n){function i(){0===--t&&s.off(e,i),n.apply(this,arguments)}var s=this;if("function"!=typeof n)throw Error("many only accepts instances of Function");return i._origin=n,this.on(e,i),s},i.prototype.emit=function(){this._events||t.call(this);var e=arguments[0];if("newListener"===e&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var n=arguments.length,i=Array(n-1),r=1;n>r;r++)i[r-1]=arguments[r];for(r=0,n=this._all.length;n>r;r++)this.event=e,this._all[r].apply(this,i)}if("error"===e&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:Error("Uncaught, unspecified 'error' event.");var o;if(this.wildcard){o=[];var a="string"==typeof e?e.split(this.delimiter):e.slice();s.call(this,o,a,this.listenerTree,0)}else o=this._events[e];if("function"==typeof o){if(this.event=e,1===arguments.length)o.call(this);else if(arguments.length>1)switch(arguments.length){case 2:o.call(this,arguments[1]);break;case 3:o.call(this,arguments[1],arguments[2]);break;default:for(var n=arguments.length,i=Array(n-1),r=1;n>r;r++)i[r-1]=arguments[r];o.apply(this,i)}return!0}if(o){for(var n=arguments.length,i=Array(n-1),r=1;n>r;r++)i[r-1]=arguments[r];for(var c=o.slice(),r=0,n=c.length;n>r;r++)this.event=e,c[r].apply(this,i);return c.length>0||this._all}return this._all},i.prototype.on=function(e,n){if("function"==typeof e)return this.onAny(e),this;if("function"!=typeof n)throw Error("on only accepts instances of Function");if(this._events||t.call(this),this.emit("newListener",e,n),this.wildcard)return r.call(this,e,n),this;if(this._events[e]){if("function"==typeof this._events[e])this._events[e]=[this._events[e],n];else if(o(this._events[e])&&(this._events[e].push(n),!this._events[e].warned)){var i=a;this._events.maxListeners!==undefined&&(i=this._events.maxListeners),i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())}}else this._events[e]=n;return this},i.prototype.onAny=function(e){if(this._all||(this._all=[]),"function"!=typeof e)throw Error("onAny only accepts instances of Function");return this._all.push(e),this},i.prototype.addListener=i.prototype.on,i.prototype.off=function(e,t){if("function"!=typeof t)throw Error("removeListener only takes instances of Function");var n,i=[];if(this.wildcard){var r="string"==typeof e?e.split(this.delimiter):e.slice();i=s.call(this,null,r,this.listenerTree,0)}else{if(!this._events[e])return this;n=this._events[e],i.push({_listeners:n})}for(var a=0;i.length>a;a++){var c=i[a];if(n=c._listeners,o(n)){for(var u=-1,h=0,l=n.length;l>h;h++)if(n[h]===t||n[h].listener&&n[h].listener===t||n[h]._origin&&n[h]._origin===t){u=h;break}if(0>u)continue;return this.wildcard?c._listeners.splice(u,1):this._events[e].splice(u,1),0===n.length&&(this.wildcard?delete c._listeners:delete this._events[e]),this}(n===t||n.listener&&n.listener===t||n._origin&&n._origin===t)&&(this.wildcard?delete c._listeners:delete this._events[e])}return this},i.prototype.offAny=function(e){var t,n=0,i=0;if(e&&this._all&&this._all.length>0){for(t=this._all,n=0,i=t.length;i>n;n++)if(e===t[n])return t.splice(n,1),this}else this._all=[];return this},i.prototype.removeListener=i.prototype.off,i.prototype.removeAllListeners=function(e){if(0===arguments.length)return!this._events||t.call(this),this;if(this.wildcard)for(var n="string"==typeof e?e.split(this.delimiter):e.slice(),i=s.call(this,null,n,this.listenerTree,0),r=0;i.length>r;r++){var o=i[r];o._listeners=null}else{if(!this._events[e])return this;this._events[e]=null}return this},i.prototype.listeners=function(e){if(this.wildcard){var n=[],i="string"==typeof e?e.split(this.delimiter):e.slice();return s.call(this,n,i,this.listenerTree,0),n}return this._events||t.call(this),this._events[e]||(this._events[e]=[]),o(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},i.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof define&&define.amd?define(function(){return i}):e.EventEmitter2=i}(i!==void 0&&i.title!==void 0&&n!==void 0?n:window)},{__browserify_process:8}],7:[function(require,module,exports){var global="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},Faye={VERSION:"0.8.9",BAYEUX_VERSION:"1.0",ID_LENGTH:160,JSONP_CALLBACK:"jsonpcallback",CONNECTION_TYPES:["long-polling","cross-origin-long-polling","callback-polling","websocket","eventsource","in-process"],MANDATORY_CONNECTION_TYPES:["long-polling","callback-polling","in-process"],ENV:global===void 0?window:global,extend:function(e,t,n){if(!t)return e;for(var i in t)t.hasOwnProperty(i)&&(e.hasOwnProperty(i)&&n===!1||e[i]!==t[i]&&(e[i]=t[i]));return e},random:function(e){if(e=e||this.ID_LENGTH,e>32){for(var t=Math.ceil(e/32),n="";t--;)n+=this.random(32);for(var i=n.split(""),s="";i.length>0;)s+=i.pop();return s}for(var r=Math.pow(2,e)-1,o=r.toString(36).length,n=Math.floor(Math.random()*r).toString(36);o>n.length;)n="0"+n;return n},clientIdFromMessages:function(e){var t=[].concat(e)[0];return t&&t.clientId},copyObject:function(e){var t,n,i;if(e instanceof Array){for(t=[],n=e.length;n--;)t[n]=Faye.copyObject(e[n]);return t}if("object"==typeof e){t=null===e?null:{};for(i in e)t[i]=Faye.copyObject(e[i]);return t}return e},commonElement:function(e,t){for(var n=0,i=e.length;i>n;n++)if(-1!==this.indexOf(t,e[n]))return e[n];return null},indexOf:function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,i=e.length;i>n;n++)if(e[n]===t)return n;return-1},map:function(e,t,n){if(e.map)return e.map(t,n);var i=[];if(e instanceof Array)for(var s=0,r=e.length;r>s;s++)i.push(t.call(n||null,e[s],s));else for(var o in e)e.hasOwnProperty(o)&&i.push(t.call(n||null,o,e[o]));return i},filter:function(e,t,n){for(var i=[],s=0,r=e.length;r>s;s++)t.call(n||null,e[s],s)&&i.push(e[s]);return i},asyncEach:function(e,t,n,i){var s=e.length,r=-1,o=0,a=!1,c=function(){return o-=1,r+=1,r===s?n&&n.call(i):(t(e[r],h),void 0)},u=function(){if(!a){for(a=!0;o>0;)c();a=!1}},h=function(){o+=1,u()};h()},toJSON:function(e){return this.stringify?this.stringify(e,function(e,t){return this[e]instanceof Array?this[e]:t}):JSON.stringify(e)},logger:function(e){"undefined"!=typeof console&&console.log(e)},timestamp:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,i=e.getDate(),s=e.getHours(),r=e.getMinutes(),o=e.getSeconds(),a=function(e){return 10>e?"0"+e:e+""};return a(t)+"-"+a(n)+"-"+a(i)+" "+a(s)+":"+a(r)+":"+a(o)}};"undefined"!=typeof window&&(window.Faye=Faye),Faye.Class=function(e,t){"function"!=typeof e&&(t=e,e=Object);var n=function(){return this.initialize?this.initialize.apply(this,arguments)||this:this},i=function(){};return i.prototype=e.prototype,n.prototype=new i,Faye.extend(n.prototype,t),n},Faye.Namespace=Faye.Class({initialize:function(){this._used={}},exists:function(e){return this._used.hasOwnProperty(e)},generate:function(){for(var e=Faye.random();this._used.hasOwnProperty(e);)e=Faye.random();return this._used[e]=e},release:function(e){delete this._used[e]}}),Faye.Error=Faye.Class({initialize:function(e,t,n){this.code=e,this.params=Array.prototype.slice.call(t),this.message=n},toString:function(){return this.code+":"+this.params.join(",")+":"+this.message}}),Faye.Error.parse=function(e){if(e=e||"",!Faye.Grammar.ERROR.test(e))return new this(null,[],e);var t=e.split(":"),n=parseInt(t[0]),i=t[1].split(","),e=t[2];return new this(n,i,e)},Faye.Error.versionMismatch=function(){return""+new this(300,arguments,"Version mismatch")},Faye.Error.conntypeMismatch=function(){return""+new this(301,arguments,"Connection types not supported")},Faye.Error.extMismatch=function(){return""+new this(302,arguments,"Extension mismatch")},Faye.Error.badRequest=function(){return""+new this(400,arguments,"Bad request")},Faye.Error.clientUnknown=function(){return""+new this(401,arguments,"Unknown client")},Faye.Error.parameterMissing=function(){return""+new this(402,arguments,"Missing required parameter")},Faye.Error.channelForbidden=function(){return""+new this(403,arguments,"Forbidden channel")},Faye.Error.channelUnknown=function(){return""+new this(404,arguments,"Unknown channel")},Faye.Error.channelInvalid=function(){return""+new this(405,arguments,"Invalid channel")},Faye.Error.extUnknown=function(){return""+new this(406,arguments,"Unknown extension")},Faye.Error.publishFailed=function(){return""+new this(407,arguments,"Failed to publish")},Faye.Error.serverError=function(){return""+new this(500,arguments,"Internal server error")},Faye.Deferrable={callback:function(e,t){if(e){if("succeeded"===this._deferredStatus)return e.apply(t,this._deferredArgs);this._callbacks=this._callbacks||[],this._callbacks.push([e,t])}},timeout:function(e,t){var n=this,i=Faye.ENV.setTimeout(function(){n.setDeferredStatus("failed",t)},1e3*e);this._timer=i},errback:function(e,t){if(e){if("failed"===this._deferredStatus)return e.apply(t,this._deferredArgs);this._errbacks=this._errbacks||[],this._errbacks.push([e,t])}},setDeferredStatus:function(){this._timer&&Faye.ENV.clearTimeout(this._timer);var e,t=Array.prototype.slice.call(arguments),n=t.shift();if(this._deferredStatus=n,this._deferredArgs=t,"succeeded"===n?e=this._callbacks:"failed"===n&&(e=this._errbacks),e)for(var i;i=e.shift();)i[0].apply(i[1],this._deferredArgs)}},Faye.Publisher={countListeners:function(e){return this._subscribers&&this._subscribers[e]?this._subscribers[e].length:0},bind:function(e,t,n){this._subscribers=this._subscribers||{};var i=this._subscribers[e]=this._subscribers[e]||[];i.push([t,n])},unbind:function(e,t,n){if(this._subscribers&&this._subscribers[e]){if(!t)return delete this._subscribers[e],void 0;for(var i=this._subscribers[e],s=i.length;s--;)t===i[s][0]&&(n&&i[s][1]!==n||i.splice(s,1))}},trigger:function(){var e=Array.prototype.slice.call(arguments),t=e.shift();if(this._subscribers&&this._subscribers[t])for(var n,i=this._subscribers[t].slice(),s=0,r=i.length;r>s;s++)n=i[s],n[0].apply(n[1],e)}},Faye.Timeouts={addTimeout:function(e,t,n,i){if(this._timeouts=this._timeouts||{},!this._timeouts.hasOwnProperty(e)){var s=this;this._timeouts[e]=Faye.ENV.setTimeout(function(){delete s._timeouts[e],n.call(i)},1e3*t)}},removeTimeout:function(e){this._timeouts=this._timeouts||{};var t=this._timeouts[e];t&&(clearTimeout(t),delete this._timeouts[e])}},Faye.Logging={LOG_LEVELS:{error:3,warn:2,info:1,debug:0},logLevel:"error",log:function(e,t){if(Faye.logger){var n=Faye.Logging.LOG_LEVELS;if(!(n[Faye.Logging.logLevel]>n[t])){var e=Array.prototype.slice.apply(e),i=" ["+t.toUpperCase()+"] [Faye",s=this.className,r=e.shift().replace(/\?/g,function(){try{return Faye.toJSON(e.shift())}catch(t){return"[Object]"}});for(var o in Faye)s||"function"==typeof Faye[o]&&this instanceof Faye[o]&&(s=o);s&&(i+="."+s),i+="] ",Faye.logger(Faye.timestamp()+i+r)}}}},function(){for(var e in Faye.Logging.LOG_LEVELS)(function(e){Faye.Logging[e]=function(){this.log(arguments,e)}})(e,Faye.Logging.LOG_LEVELS[e])}(),Faye.Grammar={LOWALPHA:/^[a-z]$/,UPALPHA:/^[A-Z]$/,ALPHA:/^([a-z]|[A-Z])$/,DIGIT:/^[0-9]$/,ALPHANUM:/^(([a-z]|[A-Z])|[0-9])$/,MARK:/^(\-|\_|\!|\~|\(|\)|\$|\@)$/,STRING:/^(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*$/,TOKEN:/^(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+$/,INTEGER:/^([0-9])+$/,CHANNEL_SEGMENT:/^(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+$/,CHANNEL_SEGMENTS:/^(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+(\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+)*$/,CHANNEL_NAME:/^\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+(\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+)*$/,WILD_CARD:/^\*{1,2}$/,CHANNEL_PATTERN:/^(\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+)*\/\*{1,2}$/,VERSION_ELEMENT:/^(([a-z]|[A-Z])|[0-9])(((([a-z]|[A-Z])|[0-9])|\-|\_))*$/,VERSION:/^([0-9])+(\.(([a-z]|[A-Z])|[0-9])(((([a-z]|[A-Z])|[0-9])|\-|\_))*)*$/,CLIENT_ID:/^((([a-z]|[A-Z])|[0-9]))+$/,ID:/^((([a-z]|[A-Z])|[0-9]))+$/,ERROR_MESSAGE:/^(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*$/,ERROR_ARGS:/^(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*(,(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*)*$/,ERROR_CODE:/^[0-9][0-9][0-9]$/,ERROR:/^([0-9][0-9][0-9]:(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*(,(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*)*:(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*|[0-9][0-9][0-9]::(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*)$/},Faye.Extensible={addExtension:function(e){this._extensions=this._extensions||[],this._extensions.push(e),e.added&&e.added(this)},removeExtension:function(e){if(this._extensions)for(var t=this._extensions.length;t--;)this._extensions[t]===e&&(this._extensions.splice(t,1),e.removed&&e.removed(this))},pipeThroughExtensions:function(e,t,n,i){if(this.debug("Passing through ? extensions: ?",e,t),!this._extensions)return n.call(i,t);var s=this._extensions.slice(),r=function(t){if(!t)return n.call(i,t);var o=s.shift();return o?(o[e]?o[e](t,r):r(t),void 0):n.call(i,t)};r(t)}},Faye.extend(Faye.Extensible,Faye.Logging),Faye.Channel=Faye.Class({initialize:function(e){this.id=this.name=e},push:function(e){this.trigger("message",e)},isUnused:function(){return 0===this.countListeners("message")}}),Faye.extend(Faye.Channel.prototype,Faye.Publisher),Faye.extend(Faye.Channel,{HANDSHAKE:"/meta/handshake",CONNECT:"/meta/connect",SUBSCRIBE:"/meta/subscribe",UNSUBSCRIBE:"/meta/unsubscribe",DISCONNECT:"/meta/disconnect",META:"meta",SERVICE:"service",expand:function(e){var t=this.parse(e),n=["/**",e],i=t.slice();i[i.length-1]="*",n.push(this.unparse(i));for(var s=1,r=t.length;r>s;s++)i=t.slice(0,s),i.push("**"),n.push(this.unparse(i));return n},isValid:function(e){return Faye.Grammar.CHANNEL_NAME.test(e)||Faye.Grammar.CHANNEL_PATTERN.test(e)},parse:function(e){return this.isValid(e)?e.split("/").slice(1):null},unparse:function(e){return"/"+e.join("/")},isMeta:function(e){var t=this.parse(e);return t?t[0]===this.META:null},isService:function(e){var t=this.parse(e);return t?t[0]===this.SERVICE:null},isSubscribable:function(e){return this.isValid(e)?!this.isMeta(e)&&!this.isService(e):null},Set:Faye.Class({initialize:function(){this._channels={}},getKeys:function(){var e=[];for(var t in this._channels)e.push(t);return e},remove:function(e){delete this._channels[e]},hasSubscription:function(e){return this._channels.hasOwnProperty(e)},subscribe:function(e,t,n){if(t)for(var i,s=0,r=e.length;r>s;s++){i=e[s];var o=this._channels[i]=this._channels[i]||new Faye.Channel(i);o.bind("message",t,n)}},unsubscribe:function(e,t,n){var i=this._channels[e];return i?(i.unbind("message",t,n),i.isUnused()?(this.remove(e),!0):!1):!1},distributeMessage:function(e){for(var t=Faye.Channel.expand(e.channel),n=0,i=t.length;i>n;n++){var s=this._channels[t[n]];s&&s.trigger("message",e.data)}}})}),Faye.Publication=Faye.Class(Faye.Deferrable),Faye.Subscription=Faye.Class({initialize:function(e,t,n,i){this._client=e,this._channels=t,this._callback=n,this._context=i,this._cancelled=!1},cancel:function(){this._cancelled||(this._client.unsubscribe(this._channels,this._callback,this._context),this._cancelled=!0)},unsubscribe:function(){this.cancel()}}),Faye.extend(Faye.Subscription.prototype,Faye.Deferrable),Faye.Client=Faye.Class({UNCONNECTED:1,CONNECTING:2,CONNECTED:3,DISCONNECTED:4,HANDSHAKE:"handshake",RETRY:"retry",NONE:"none",CONNECTION_TIMEOUT:60,DEFAULT_RETRY:5,DEFAULT_ENDPOINT:"/bayeux",INTERVAL:0,initialize:function(e,t){this.info("New client created for ?",e),this._options=t||{},this.endpoint=e||this.DEFAULT_ENDPOINT,this.endpoints=this._options.endpoints||{},this.transports={},this._cookies=Faye.CookieJar&&new Faye.CookieJar,this._headers={},this._disabled=[],this.retry=this._options.retry||this.DEFAULT_RETRY,this._state=this.UNCONNECTED,this._channels=new Faye.Channel.Set,this._messageId=0,this._responseCallbacks={},this._advice={reconnect:this.RETRY,interval:1e3*(this._options.interval||this.INTERVAL),timeout:1e3*(this._options.timeout||this.CONNECTION_TIMEOUT)},Faye.Event&&Faye.Event.on(Faye.ENV,"beforeunload",function(){0>Faye.indexOf(this._disabled,"autodisconnect")&&this.disconnect()},this)},disable:function(e){this._disabled.push(e)},setHeader:function(e,t){this._headers[e]=t},getClientId:function(){return this._clientId},getState:function(){switch(this._state){case this.UNCONNECTED:return"UNCONNECTED";case this.CONNECTING:return"CONNECTING";case this.CONNECTED:return"CONNECTED";case this.DISCONNECTED:return"DISCONNECTED"}},handshake:function(e,t){if(this._advice.reconnect!==this.NONE&&this._state===this.UNCONNECTED){this._state=this.CONNECTING;var n=this;this.info("Initiating handshake with ?",this.endpoint),this._selectTransport(Faye.MANDATORY_CONNECTION_TYPES),this._send({channel:Faye.Channel.HANDSHAKE,version:Faye.BAYEUX_VERSION,supportedConnectionTypes:[this._transport.connectionType]},function(i){i.successful?(this._state=this.CONNECTED,this._clientId=i.clientId,this._selectTransport(i.supportedConnectionTypes),this.info("Handshake successful: ?",this._clientId),this.subscribe(this._channels.getKeys(),!0),e&&e.call(t)):(this.info("Handshake unsuccessful"),Faye.ENV.setTimeout(function(){n.handshake(e,t)},this._advice.interval),this._state=this.UNCONNECTED)},this)}},connect:function(e,t){if(this._advice.reconnect!==this.NONE&&this._state!==this.DISCONNECTED){if(this._state===this.UNCONNECTED)return this.handshake(function(){this.connect(e,t)},this);this.callback(e,t),this._state===this.CONNECTED&&(this.info("Calling deferred actions for ?",this._clientId),this.setDeferredStatus("succeeded"),this.setDeferredStatus("deferred"),this._connectRequest||(this._connectRequest=!0,this.info("Initiating connection for ?",this._clientId),this._send({channel:Faye.Channel.CONNECT,clientId:this._clientId,connectionType:this._transport.connectionType},this._cycleConnection,this)))}},disconnect:function(){this._state===this.CONNECTED&&(this._state=this.DISCONNECTED,this.info("Disconnecting ?",this._clientId),this._send({channel:Faye.Channel.DISCONNECT,clientId:this._clientId},function(e){e.successful&&this._transport.close()},this),this.info("Clearing channel listeners for ?",this._clientId),this._channels=new Faye.Channel.Set)},subscribe:function(e,t,n){if(e instanceof Array)return Faye.map(e,function(e){return this.subscribe(e,t,n)},this);var i=new Faye.Subscription(this,e,t,n),s=t===!0,r=this._channels.hasSubscription(e);return r&&!s?(this._channels.subscribe([e],t,n),i.setDeferredStatus("succeeded"),i):(this.connect(function(){this.info("Client ? attempting to subscribe to ?",this._clientId,e),s||this._channels.subscribe([e],t,n),this._send({channel:Faye.Channel.SUBSCRIBE,clientId:this._clientId,subscription:e},function(s){if(!s.successful)return i.setDeferredStatus("failed",Faye.Error.parse(s.error)),this._channels.unsubscribe(e,t,n);var r=[].concat(s.subscription);this.info("Subscription acknowledged for ? to ?",this._clientId,r),i.setDeferredStatus("succeeded")},this)},this),i)},unsubscribe:function(e,t,n){if(e instanceof Array)return Faye.map(e,function(e){return this.unsubscribe(e,t,n)},this);var i=this._channels.unsubscribe(e,t,n);i&&this.connect(function(){this.info("Client ? attempting to unsubscribe from ?",this._clientId,e),this._send({channel:Faye.Channel.UNSUBSCRIBE,clientId:this._clientId,subscription:e},function(e){if(e.successful){var t=[].concat(e.subscription);this.info("Unsubscription acknowledged for ? from ?",this._clientId,t)}},this)},this)},publish:function(e,t){var n=new Faye.Publication;return this.connect(function(){this.info("Client ? queueing published message to ?: ?",this._clientId,e,t),this._send({channel:e,data:t,clientId:this._clientId},function(e){e.successful?n.setDeferredStatus("succeeded"):n.setDeferredStatus("failed",Faye.Error.parse(e.error))},this)},this),n},receiveMessage:function(e){this.pipeThroughExtensions("incoming",e,function(e){if(e&&(e.advice&&this._handleAdvice(e.advice),this._deliverMessage(e),void 0!==e.successful)){var t=this._responseCallbacks[e.id];t&&(delete this._responseCallbacks[e.id],t[0].call(t[1],e))}},this)},_selectTransport:function(e){Faye.Transport.get(this,e,this._disabled,function(e){this.debug("Selected ? transport for ?",e.connectionType,e.endpoint),e!==this._transport&&(this._transport&&this._transport.close(),this._transport=e,this._transport.cookies=this._cookies,this._transport.headers=this._headers,e.bind("down",function(){(void 0===this._transportUp||this._transportUp)&&(this._transportUp=!1,this.trigger("transport:down"))},this),e.bind("up",function(){void 0!==this._transportUp&&this._transportUp||(this._transportUp=!0,this.trigger("transport:up"))},this))},this)},_send:function(e,t,n){e.id=this._generateMessageId(),t&&(this._responseCallbacks[e.id]=[t,n]),this.pipeThroughExtensions("outgoing",e,function(e){e&&this._transport.send(e,this._advice.timeout/1e3)},this)},_generateMessageId:function(){return this._messageId+=1,this._messageId>=Math.pow(2,32)&&(this._messageId=0),this._messageId.toString(36)},_handleAdvice:function(e){Faye.extend(this._advice,e),this._advice.reconnect===this.HANDSHAKE&&this._state!==this.DISCONNECTED&&(this._state=this.UNCONNECTED,this._clientId=null,this._cycleConnection())},_deliverMessage:function(e){e.channel&&void 0!==e.data&&(this.info("Client ? calling listeners for ? with ?",this._clientId,e.channel,e.data),this._channels.distributeMessage(e))},_teardownConnection:function(){this._connectRequest&&(this._connectRequest=null,this.info("Closed connection for ?",this._clientId))},_cycleConnection:function(){this._teardownConnection();var e=this;Faye.ENV.setTimeout(function(){e.connect()},this._advice.interval)}}),Faye.extend(Faye.Client.prototype,Faye.Deferrable),Faye.extend(Faye.Client.prototype,Faye.Publisher),Faye.extend(Faye.Client.prototype,Faye.Logging),Faye.extend(Faye.Client.prototype,Faye.Extensible),Faye.Transport=Faye.extend(Faye.Class({MAX_DELAY:0,batching:!0,initialize:function(e,t){this._client=e,this.endpoint=t,this._outbox=[]},close:function(){},send:function(e,t){return this.debug("Client ? sending message to ?: ?",this._client._clientId,this.endpoint,e),this.batching?(this._outbox.push(e),this._timeout=t,e.channel===Faye.Channel.HANDSHAKE?this.addTimeout("publish",.01,this.flush,this):(e.channel===Faye.Channel.CONNECT&&(this._connectMessage=e),this.shouldFlush&&this.shouldFlush(this._outbox)?this.flush():(this.addTimeout("publish",this.MAX_DELAY,this.flush,this),void 0))):this.request([e],t)},flush:function(){this.removeTimeout("publish"),this._outbox.length>1&&this._connectMessage&&(this._connectMessage.advice={timeout:0}),this.request(this._outbox,this._timeout),this._connectMessage=null,this._outbox=[]},receive:function(e){this.debug("Client ? received from ?: ?",this._client._clientId,this.endpoint,e);for(var t=0,n=e.length;n>t;t++)this._client.receiveMessage(e[t])},retry:function(e,t){var n=!1,i=1e3*this._client.retry,s=this;return function(){n||(n=!0,Faye.ENV.setTimeout(function(){s.request(e,t)},i))}}}),{MAX_URL_LENGTH:2048,get:function(e,t,n,i,s){var r=e.endpoint;Faye.asyncEach(this._transports,function(o,a){var c=o[0],u=o[1],h=e.endpoints[c]||r;return Faye.indexOf(n,c)>=0?a():0>Faye.indexOf(t,c)?(u.isUsable(e,h,function(){}),a()):(u.isUsable(e,h,function(t){if(!t)return a();var n=u.hasOwnProperty("create")?u.create(e,h):new u(e,h);i.call(s,n)}),void 0)},function(){throw Error("Could not find a usable connection type for "+r)})},register:function(e,t){this._transports.push([e,t]),t.prototype.connectionType=e},_transports:[]}),Faye.extend(Faye.Transport.prototype,Faye.Logging),Faye.extend(Faye.Transport.prototype,Faye.Publisher),Faye.extend(Faye.Transport.prototype,Faye.Timeouts),Faye.Event={_registry:[],on:function(e,t,n,i){var s=function(){n.call(i)};e.addEventListener?e.addEventListener(t,s,!1):e.attachEvent("on"+t,s),this._registry.push({_element:e,_type:t,_callback:n,_context:i,_handler:s})},detach:function(e,t,n,i){for(var s,r=this._registry.length;r--;)s=this._registry[r],e&&e!==s._element||t&&t!==s._type||n&&n!==s._callback||i&&i!==s._context||(s._element.removeEventListener?s._element.removeEventListener(s._type,s._handler,!1):s._element.detachEvent("on"+s._type,s._handler),this._registry.splice(r,1),s=null)}},Faye.Event.on(Faye.ENV,"unload",Faye.Event.detach,Faye.Event),Faye.URI=Faye.extend(Faye.Class({queryString:function(){var e=[];for(var t in this.params)this.params.hasOwnProperty(t)&&e.push(encodeURIComponent(t)+"="+encodeURIComponent(this.params[t]));return e.join("&")},isSameOrigin:function(){var e=Faye.URI.parse(Faye.ENV.location.href,!1),t=e.hostname!==this.hostname||e.port!==this.port||e.protocol!==this.protocol;return!t},toURL:function(){var e=this.queryString();
return this.protocol+"//"+this.hostname+(this.port?":"+this.port:"")+this.pathname+(e?"?"+e:"")+this.hash}}),{parse:function(e,t){if("string"!=typeof e)return e;var n,i=new this,s=function(t,n,s){e=e.replace(n,function(e){return i[t]=e,""}),void 0===i[t]&&(i[t]=s?Faye.ENV.location[t]:"")};if(s("protocol",/^https?\:/,!0),s("host",/^\/\/[^\/]+/,!0),/^\//.test(e)||(e=Faye.ENV.location.pathname.replace(/[^\/]*$/,"")+e),s("pathname",/^\/[^\?#]*/),s("search",/^\?[^#]*/),s("hash",/^#.*/),/^\/\//.test(i.host)?(i.host=i.host.substr(2),n=i.host.split(":"),i.hostname=n[0],i.port=n[1]||""):(i.hostname=Faye.ENV.location.hostname,i.port=Faye.ENV.location.port),t===!1)i.params={};else{for(var r=i.search.replace(/^\?/,""),o=r?r.split("&"):[],a=o.length,c={};a--;)n=o[a].split("="),c[decodeURIComponent(n[0]||"")]=decodeURIComponent(n[1]||"");"object"==typeof t&&Faye.extend(c,t),i.params=c}return i}}),this.JSON||(JSON={}),function(){function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,i,s,r,o,a=gap,c=t[e];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?c+"":"null";case"boolean":case"null":return c+"";case"object":if(!c)return"null";if(gap+=indent,o=[],"[object Array]"===Object.prototype.toString.apply(c)){for(r=c.length,n=0;r>n;n+=1)o[n]=str(n,c)||"null";return s=0===o.length?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+a+"]":"["+o.join(",")+"]",gap=a,s}if(rep&&"object"==typeof rep)for(r=rep.length,n=0;r>n;n+=1)i=rep[n],"string"==typeof i&&(s=str(i,c),s&&o.push(quote(i)+(gap?": ":":")+s));else for(i in c)Object.hasOwnProperty.call(c,i)&&(s=str(i,c),s&&o.push(quote(i)+(gap?": ":":")+s));return s=0===o.length?"{}":gap?"{\n"+gap+o.join(",\n"+gap)+"\n"+a+"}":"{"+o.join(",")+"}",gap=a,s}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z"},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;Faye.stringify=function(e,t,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;n>i;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw Error("JSON.stringify");return str("",{"":e})},"function"!=typeof JSON.stringify&&(JSON.stringify=Faye.stringify),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,i,s=e[t];if(s&&"object"==typeof s)for(n in s)Object.hasOwnProperty.call(s,n)&&(i=walk(s,n),void 0!==i?s[n]=i:delete s[n]);return reviver.call(e,t,s)}var j;if(cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),Faye.Transport.WebSocket=Faye.extend(Faye.Class(Faye.Transport,{UNCONNECTED:1,CONNECTING:2,CONNECTED:3,batching:!1,isUsable:function(e,t){this.callback(function(){e.call(t,!0)}),this.errback(function(){e.call(t,!1)}),this.connect()},request:function(e){if(0!==e.length){this._messages=this._messages||{};for(var t=0,n=e.length;n>t;t++)this._messages[e[t].id]=e[t];this.callback(function(t){t.send(Faye.toJSON(e))}),this.connect()}},close:function(){this._socket&&(this._socket.onclose=this._socket.onerror=null,this._socket.close(),delete this._socket,this.setDeferredStatus("deferred"),this._state=this.UNCONNECTED)},connect:function(){if(!Faye.Transport.WebSocket._unloaded&&(this._state=this._state||this.UNCONNECTED,this._state===this.UNCONNECTED)){this._state=this.CONNECTING;var e=Faye.Transport.WebSocket.getClass();if(!e)return this.setDeferredStatus("failed");this._socket=new e(Faye.Transport.WebSocket.getSocketUrl(this.endpoint));var t=this;this._socket.onopen=function(){t._state=t.CONNECTED,t._everConnected=!0,t.setDeferredStatus("succeeded",t._socket),t.trigger("up")},this._socket.onmessage=function(e){var n=JSON.parse(e.data);if(n){n=[].concat(n);for(var i=0,s=n.length;s>i;i++)delete t._messages[n[i].id];t.receive(n)}},this._socket.onclose=this._socket.onerror=function(){var e=t._state===t.CONNECTED;if(t.setDeferredStatus("deferred"),t._state=t.UNCONNECTED,t.close(),e)return t.resend();if(!t._everConnected)return t.setDeferredStatus("failed");var n=1e3*t._client.retry;Faye.ENV.setTimeout(function(){t.connect()},n),t.trigger("down")}}},resend:function(){if(this._messages){var e=Faye.map(this._messages,function(e,t){return t});this.request(e)}}}),{getSocketUrl:function(e){return Faye.URI&&(e=Faye.URI.parse(e).toURL()),e.replace(/^http(s?):/gi,"ws$1:")},getClass:function(){return Faye.WebSocket&&Faye.WebSocket.Client||Faye.ENV.WebSocket||Faye.ENV.MozWebSocket},isUsable:function(e,t,n,i){this.create(e,t).isUsable(n,i)},create:function(e,t){var n=e.transports.websocket=e.transports.websocket||{};return n[t]=n[t]||new this(e,t),n[t]}}),Faye.extend(Faye.Transport.WebSocket.prototype,Faye.Deferrable),Faye.Transport.register("websocket",Faye.Transport.WebSocket),Faye.Event&&Faye.Event.on(Faye.ENV,"beforeunload",function(){Faye.Transport.WebSocket._unloaded=!0}),Faye.Transport.EventSource=Faye.extend(Faye.Class(Faye.Transport,{initialize:function(e,t){if(Faye.Transport.prototype.initialize.call(this,e,t),!Faye.ENV.EventSource)return this.setDeferredStatus("failed");this._xhr=new Faye.Transport.XHR(e,t);var n=new EventSource(t+"/"+e.getClientId()),i=this;n.onopen=function(){i._everConnected=!0,i.setDeferredStatus("succeeded"),i.trigger("up")},n.onerror=function(){i._everConnected?i.trigger("down"):(i.setDeferredStatus("failed"),n.close())},n.onmessage=function(e){i.receive(JSON.parse(e.data)),i.trigger("up")},this._socket=n},isUsable:function(e,t){this.callback(function(){e.call(t,!0)}),this.errback(function(){e.call(t,!1)})},request:function(e,t){this._xhr.request(e,t)},close:function(){this._socket&&(this._socket.onerror=null,this._socket.close(),delete this._socket)}}),{isUsable:function(e,t,n,i){var s=e.getClientId();return s?(Faye.Transport.XHR.isUsable(e,t,function(s){return s?(this.create(e,t).isUsable(n,i),void 0):n.call(i,!1)},this),void 0):n.call(i,!1)},create:function(e,t){var n=e.transports.eventsource=e.transports.eventsource||{},i=e.getClientId(),t=t+"/"+(i||"");return n[t]=n[t]||new this(e,t),n[t]}}),Faye.extend(Faye.Transport.EventSource.prototype,Faye.Deferrable),Faye.Transport.register("eventsource",Faye.Transport.EventSource),Faye.Transport.XHR=Faye.extend(Faye.Class(Faye.Transport,{request:function(e,t){var n=this.retry(e,t),i=Faye.URI.parse(this.endpoint).pathname,s=this,r=Faye.ENV.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;r.open("POST",i,!0),r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("Pragma","no-cache"),r.setRequestHeader("X-Requested-With","XMLHttpRequest");var o=this.headers;for(var a in o)o.hasOwnProperty(a)&&r.setRequestHeader(a,o[a]);var c=function(){r.abort()};Faye.Event.on(Faye.ENV,"beforeunload",c);var u=function(){Faye.Event.detach(Faye.ENV,"beforeunload",c),r.onreadystatechange=function(){},r=null};r.onreadystatechange=function(){if(4===r.readyState){var e=null,t=r.status,i=t>=200&&300>t||304===t||1223===t;if(!i)return u(),n(),s.trigger("down");try{e=JSON.parse(r.responseText)}catch(o){}u(),e?(s.receive(e),s.trigger("up")):(n(),s.trigger("down"))}},r.send(Faye.toJSON(e))}}),{isUsable:function(e,t,n,i){n.call(i,Faye.URI.parse(t).isSameOrigin())}}),Faye.Transport.register("long-polling",Faye.Transport.XHR),Faye.Transport.CORS=Faye.extend(Faye.Class(Faye.Transport,{request:function(e,t){var n=Faye.ENV.XDomainRequest?XDomainRequest:XMLHttpRequest,i=new n,s=this.retry(e,t),r=this;i.open("POST",this.endpoint,!0),i.setRequestHeader&&i.setRequestHeader("Pragma","no-cache");var o=function(){return i?(i.onload=i.onerror=i.ontimeout=i.onprogress=null,i=null,Faye.ENV.clearTimeout(c),!0):!1};i.onload=function(){var e=null;try{e=JSON.parse(i.responseText)}catch(t){}o(),e?(r.receive(e),r.trigger("up")):(s(),r.trigger("down"))};var a=function(){o(),s(),r.trigger("down")},c=Faye.ENV.setTimeout(a,1500*t);i.onerror=a,i.ontimeout=a,i.onprogress=function(){},i.send("message="+encodeURIComponent(Faye.toJSON(e)))}}),{isUsable:function(e,t,n,i){if(Faye.URI.parse(t).isSameOrigin())return n.call(i,!1);if(Faye.ENV.XDomainRequest)return n.call(i,Faye.URI.parse(t).protocol===Faye.URI.parse(Faye.ENV.location).protocol);if(Faye.ENV.XMLHttpRequest){var s=new Faye.ENV.XMLHttpRequest;return n.call(i,void 0!==s.withCredentials)}return n.call(i,!1)}}),Faye.Transport.register("cross-origin-long-polling",Faye.Transport.CORS),Faye.Transport.JSONP=Faye.extend(Faye.Class(Faye.Transport,{shouldFlush:function(e){var t={message:Faye.toJSON(e),jsonp:"__jsonp"+Faye.Transport.JSONP._cbCount+"__"},n=Faye.URI.parse(this.endpoint,t).toURL();return n.length>=Faye.Transport.MAX_URL_LENGTH},request:function(e,t){var n={message:Faye.toJSON(e)},i=document.getElementsByTagName("head")[0],s=document.createElement("script"),r=Faye.Transport.JSONP.getCallbackName(),o=Faye.URI.parse(this.endpoint,n),a=this.retry(e,t),c=this;Faye.ENV[r]=function(e){h(),c.receive(e),c.trigger("up")};var u=Faye.ENV.setTimeout(function(){h(),a(),c.trigger("down")},1500*t),h=function(){if(!Faye.ENV[r])return!1;Faye.ENV[r]=void 0;try{delete Faye.ENV[r]}catch(e){}return Faye.ENV.clearTimeout(u),s.parentNode.removeChild(s),!0};o.params.jsonp=r,s.type="text/javascript",s.src=o.toURL(),i.appendChild(s)}}),{_cbCount:0,getCallbackName:function(){return this._cbCount+=1,"__jsonp"+this._cbCount+"__"},isUsable:function(e,t,n,i){n.call(i,!0)}}),Faye.Transport.register("callback-polling",Faye.Transport.JSONP)},{}],8:[function(e,t){var n=t.exports={};n.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",function(e){if(e.source===window&&"process-tick"===e.data&&(e.stopPropagation(),n.length>0)){var t=n.shift();t()}},!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),n.title="browser",n.browser=!0,n.env={},n.argv=[],n.binding=function(){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(){throw Error("process.chdir is not supported")}},{}]},{},[1]);